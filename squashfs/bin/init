#!/bin/busybox sh

# Chromium OS Factory Shim original init: https://chromium.googlesource.com/chromiumos/platform/initramfs/+/refs/heads/main/factory_shim/init

# Detects available TTY based on the environment
detect_tty() {
  if [ -f "/bin/frecon-lite" ]; then
    export TTY1="/dev/pts/0"
    export TTY2="/dev/pts/1"
  else
    export TTY1="/dev/tty1"
    export TTY2="/dev/tty2"
  fi
}

# Set up the environment and install any necessary tools
setup_environment() {
  /bin/busybox --install /bin || true
}

# Main function to initialize and run bootstrap
main() {
  setup_environment
  detect_tty
  # Execute bootstrap with redirected I/O for logging or halt on error
  exec bootstrap.sh < "$TTY1" >> "$TTY1" 2>&1 || sleep 1d
}

main "$@"
exit 1
